# 医療費管理システム

## 概要
このシステムは、Google Apps Script (GAS)を使用して、医療費の明細をスプレッドシートで管理するためのツールです。医療機関での診療記録を効率的に記録・管理することができます。

## 機能
- 医療費明細の記録と管理
- スプレッドシートでのデータ整理
- Webアプリケーションとしての利用（APIエンドポイント提供）
- 自動的な数値フォーマット設定

## 必要要件
- Googleアカウント
- Googleスプレッドシート
- Google Apps Scriptの実行環境

## セットアップ手順
1. 新しいGoogleスプレッドシートを作成
2. スクリプトエディタを開く（ツール > スクリプトエディタ）
3. `Code.js`の内容をコピー＆ペースト
4. スプレッドシートを開き、「医療費管理」メニューから「初期設定」を実行

## 使用方法

### 初期設定
1. スプレッドシートを開く
2. メニューバーから「医療費管理」を選択
3. 「初期設定」をクリック
   - ヘッダーが自動的に設定されます
   - 列幅が自動調整されます
   - 書式設定が適用されます

### データの追加方法
1. Webアプリケーションとして使用する場合：
   - POSTリクエストを`doPost`エンドポイントに送信
   - JSON形式でデータを送信

2. 手動でテストする場合：
   - スクリプトエディタで`testAddRecord`関数を実行

### データ形式
```json
{
  "record_date": "YYYY-MM-DD",    // 記録日
  "date": "YYYY-MM-DD",          // 診療日
  "hospital_name": "病院名",
  "patient_name": "患者名",
  "department": "診療科",
  "first_visit_fee": 数値,        // 初診料
  "re_visit_fee": 数値,          // 再診料
  "medical_management_fee": 数値,  // 医学管理料
  "blood_test_fee": 数値,        // 血液検査料
  "urine_test_fee": 数値,        // 尿検査料
  "xray_fee": 数値,             // レントゲン料
  "image_diagnosis_fee": 数値,    // 画像診断料
  "prescription_fee": 数値,      // 処方箋料
  "medication_cost": 数値,       // 薬剤費
  "injection_fee": 数値,        // 注射料
  "treatment_fee": 数値,        // 処置料
  "surgery_fee": 数値,          // 手術料
  "total_points": 数値,         // 合計点数
  "total_medical_cost": 数値,    // 総医療費
  "patient_burden_amount": 数値  // 患者負担額
}
```

## 注意事項
- 数値が不要な項目は"-"を入力
- 日付は"YYYY-MM-DD"形式で入力
- 金額は数値で入力（カンマ区切りは自動的に適用）

## エラーハンドリング
- データ形式が不正な場合はエラーメッセージを返却
- スプレッドシートの操作に失敗した場合はエラーログを記録

## 開発者向け情報
- スクリプトの実行ログは「表示 > ログ」で確認可能
- デバッグは「実行 > 関数を実行」から行えます
- テスト用のサンプルデータは`testAddRecord`関数に含まれています

## ライセンス
このプロジェクトはMITライセンスの下で公開されています。

## iOSショートカット連携

本システムはiOSショートカットと連携して、スマートフォンからも医療費明細データを簡単に送信できます。

- ショートカット配布URL: [医療費明細管理ショートカットを入手する](https://www.icloud.com/shortcuts/51a318a46c2d452ca7c4b3a6e4dce7c5)

### ショートカットの主な機能
- 画像やテキストから医療費明細データを抽出し、GASエンドポイントへ自動送信
- GASエンドポイントURLをショートカット内で設定可能
- JSON形式でデータを送信

### 使い方
1. 上記URLからショートカットをiOSに追加
2. GASエンドポイント（デプロイ後のWebアプリURL）をショートカットに設定
3. 画像やテキストを選択してショートカットを実行
4. 医療費明細データがGoogleスプレッドシートに自動登録されます 